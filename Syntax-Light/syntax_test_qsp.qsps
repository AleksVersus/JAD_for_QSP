// SYNTAX TEST "Packages/QSP/qsp.sublime-syntax"

Данный файл является тестовым файлом для проверки синтаксиса QSP 5.7.0. в текстовом редакторе Sublime Text 3
Весь текст между локациями подсвечивается как комментарии, так как он не включается в итоговый файл игры.

То есть между локациями Вы можете писать всё, что угодно. Это никак не повлияет на игру.

Данное место можно использовать для встраивания команд препроцессора.

Имена локаций записываются после символа решётки #, который должен стоять в начале строки,
при этом после решётки # не обязательно ставить пробел, но для читаемости кода рекомендую ставить

# [start]
*clr & *clear
*p "Данная локация демонстрирует подсветку операторов, таких как *pl *p *nl p pl nl и других."
*pl "Звёздочка присутствует только у четырёх операторов"
*nl "Это *pl *p *nl *clear"

clr & clear
p "Текст для вывода в окно дополнительного описания"
nl "Ещё строка текста для вывода в окно дополнительного описания."
pl "В этой строке демонстрируем подсветку вложенных выражений. <<$rnd(56,'67',propt)+'Заметьте'>>

внутри вложенных выражений (подвыражений) нельзя использовать символы той же группы, которые открывают строку.

Либо нужно экранировать их. Здесь кстати продемонстрирована многострочная строка."

! однострочные комментарии прекрасно работают, как и однострочные действия
act "Так выглядит действие": *gosub "символ звёздочки употреблённый с неправильным оператором подсвечивается, как ошибка."
! многострочные комментарии " позволяют включать в себя несколько строк
данный комментарий может "содержать кавычки, но в парном количестве". Если
кавычек нечётное число, комментарий ломает весь остальной синтаксис. Точно
так же это работает и в Quest Generator " Многострочное действие:
act "Многострочное действие":
	pl $rnd
	! Запись ' символа $ перед названием функции, которая возвращает только
	число, так же подсвечивается ошибкой. Как вы можете видеть, данный комментарий
	тоже многострочный. Здесь уже между крайними апострофами можно размещать только
	чётное число апострофов, однако кавычки " " " можно размещать в любых количествах
	так же в любых количествах можно размещать фигурные скобки { { }} и другие символы
	{{{ главное, чтоб комментарий был закрыт апострофом ' вот так.
end по идее весь текст после энда игнорируется плеером. Но я не стал пока подсвечивать его как комментарий

! Теперь нужно показать, как работает комментарий с фигурными скобками {
	На каждую открытую скобку обязятельно должна приходиться одна зкарытая { { } }
	Помимо этого, если мы здесь внутри фигурных скобко используем апостроф ', у этого
	апострофа должен быть напарник '. То же самое касается "кавычек"
	Однако "внутри 'кавычек можно' помещать' апострофы" в любом количестве и наоборот
закрываем комментарий { } { } обязательно 
фигурной скобкой } но и после закрытия до конца строки комментарий продолжается.

! закрывать локацию можно одиночным символом - Все остальные символы не учитываются
! но для удобства обычно пишут вот такую конструкцию:
--- [start] ---------------------------------

Дальше идут локации со случайным кодом, которые демонстрируют подсветку различных составляющих игры. Обратите внимание на строки 95 и 96

# [ошибки]
! На этой локации постараемся собрать все типичные ошибки

! лишний символ $ для числовых функций и ситемных переменных
$bcolor=$rgb(43,56,56)
! правильные текстовые системные переменные и текстовые функции
$counter=$input("Введите название локации-счётчика")
! перед названием текстовых системных переменных и текстовых функций обязательно должен ставиться знак доллара
fname=123 & str(456)
! правильные названия числовых системных переменных и функций
nosave=1 & val("456")
! запись звёздочки перед оператором
*goto "домой"
! запись звёздочки разрешена только для операторов работы с текстом в окне основного описания
*pl "текст" & *p "текст" *nl "текст"  *clr & *clear
! запись неполного оператора
435 ! & 435 ! 234
456 + & 456+999
456 >
456 >=
456 <=
! не поддерживаются подсветкой, но поддерживаются QSP 5.7.0 => и =<
345 => 234
345 =< 234
234 + 234 + 345 + 678
! лишняя запятая
func("rndstr",99,12,)
! запятая в начале строки пока не подсвечивается, как ошибка
,345
'234','234',234,234
--- [ошибки] ---------------------------------

# [0.1_game_info]
local a, b, c
"<center><h1><font color=#dddd00>ВОЛШЕБСТВО И СТАЛЬ. v 1.2</font></h1></center><center><font color=#000000><table width=70% bgcolor=#ffeedd border=2 cellspacing=5 cellpadding=20><tr><td>
<div align=justify>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Игра построена на движке <font color=#ff8800>MAGICON.FB v 0.2</font>.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Движок подключается в качестве модуля drive.qsp
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;В качестве модулей так же подключаются базы bases.qsp , вводные данные intro.qsp и прочие необходимые библиотеки.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Фактически игра представлет собой набор сценариев/скриптов и текстов, использующих движок, как набор функций для работы скриптов и обработки текстов.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Для работы всех прочих модулей и самих игровых скриптов необходимо подключение стандартных библиотек easy.libs</div>


<center><a href=""exec: goto '[start]'"">Назад</a></center></td></tr></table></font></center>"
--- [0.1_game_info] ---------------------------------

$func

# [м:0]_общий_вид_локации_места
! Данная локация не является действующей. Это общий вид, указывающий жёсткую конструкцию, используемую при составлении локаций места.
$args[0] = $args[0]	&	!	обязательная строка. Первый аргумент, который должен содержать ай-ди локации. На локациях места не используется
$args[1] = $args[1]	&	!	обязательная строка. Второй аргумент, который содержит управляющие слова или конструкции. При простом посещении "комнаты" он пустой.
$args[2] = $args[2]	&	!	необязательная строка. Аргумент возврата. Если есть, нужно отправить следующие две строки, в противном случае они тоже не нужны.

if $args[1]='':
! обязательная конструкция, позволяющая выполнять включённый в неё скрипт при простом посещении "комнаты"
	if здесь_был[$curloc]=0:
	! необязательная, но популярная конструкция, позволяющая выполнить скрипт однократно при первом посещении "комнаты"
		gosub 'add.new.obj','<заголовок> [name:Дом, который построил Джек:name] [type:здание:type]',"",$curloc
			!	{ необязательная, 
		но очень важная строка. Если вы не создадите заголовок для своей локации, на экран будет выводиться надпись НЕИЗВЕСТНАЯ ТЕРРИТОРИЯ,
		что естественно будет сбивать с толку игрока. К тому же заголовок по сути и является объектом локация, позволяет управлять ею и изменять 
		некоторые её свойства""jkkkk} опопопопопоо " " аалалалалалалала { } lflflflflflflflfl
	end
	!здесь могут быть любые скрипты.
	$lvar['локация.исходник']={! Подсветка комментария, который идёт сразу за фигурной скобкой пока не работает, так как я ещё думаю, как лучше парсить подсветку внутри таких конструкций, однако если написать комментарий в следующей строке за фигурной скобкой, он подсветится адекватно
! этот комментарий подсвечивается адекватно
	
	if $args[1]='':
		
	end
	
	Например это может выглядеть так
	if $args[1]='':
		if здесь_был[$curloc]=0:
			$lvar['локация.исходник']='Текст, который вы увидите при первом посещении локации.'
		else
			$lvar['локация.исходник']='Текст, который вы увидите при последующих посещениях локации.'
		end
		$lvar['локация.исходник']='Текст, который вы увидите независимо от того, который раз посещаете локацию.'
	end
	}
	act '<font color=#884488>Действие, которое будет видно только при $GAME_INTERFACE["show.acts"]="show". Безусловный переход.</font>':
		goto '[м:1]_дом'
	end
end
--- [м:0]_общий_вид_локации_места ---------------------------------

# [м:1]_дом
*PL '------- базовое описание --------'
*PL 'Это описание локации из поля "будет выведено в любом случае". Здесь так же можешь использовать динамический текст.'
*PL '(Базовый описаний//Базовая описания)'
*PL '-------- базовое описание -----------'
! типичный вид локации места:
$args[0] = $args[0]	&	!	первый аргумент передаёт ай-ди локации. На локациях места не используется.
$args[1] = $args[1]	&	!	второй аргумент передаёт управляющее слово. Например, если локацией является запертая комната, в которой находится персонаж, войти в эту комнату можно только с разрешения персонажа.
if $args[1]='':
! скрипты выполняемые при посещении локации. 
	if здесь_был[$curloc]=0:
		! -------------- Скрипты выполняемые при первом посещении --------------------------
		! Новый объект ключ
		gosub 'add.new.obj','<key> [name:Ключ от дома, который построил Джек:name] [key:ключ_от_дома:key]',$func('add.new.obj','<keys> [name:Связка ключей:name] [color:0088aa] [oneself] [:keys:]','INVENTORY','KEYS'),'KEY',1
		! Заголовок здесь - является новым объектом игры! Добавляется объект с ай-ди-шником повторяющим название локации
		gosub 'add.new.obj','<заголовок> [name:Дом, который построил Джек:name] [type:здание:type] [place::place] [target:[оружие]:target] [menergy:u1:свет:u1 p1:2000 u2:тьма:u2 p2:155:menergy]','',$curloc
		! Переход на улицу в ссылке
		gosub 'add.new.obj','<link> [name:Выйти на улицу.:name] <goto:[loc:[м:2]_улица:loc] [time:[minute:340]:time]:goto>','','из дома на улицу'
		gosub 'add.new.obj','<link> <goto:[loc:[chest]:loc] [did:сундук;1_гардеробная:did] :goto>','','гардероб в доме'
		gosub 'add.new.obj','<link> [name:Зайти в кузницу.:name] <goto:[loc:[chest]:loc] [did:сундук;1010_простая_кузница:did] [time:[minute:5]:time] :goto>','','кузница в доме'
		gosub 'add.new.obj','<link> [name:Алтарь у печки.:name] <goto:[loc:[chest]:loc] [did:сундук;1020_алтарь:did] [time:[minute:5]:time] [spec:set_altar:spec]:goto>','','алтарь в доме'
		gosub 'add.new.obj','<goto> <goto:[name:<font color=#888800>[говорить с торговцем]</font>:name] [loc:[chest]:loc] [did:торговец;татиан:did]:goto>',$curloc,'GOTO'
		gosub 'add.new.obj','<goto> <goto:[name:Обычная кухня:name] [loc:место;стандартная_кухня:loc] [did:место;дом

------

_который_построил_джек_стандартная кухня:did] [rule:{name:в доме, который построил Джек:name}:rule]:goto>','жжжжж',$curloc,'GOTO'
		gosub 'base.new.obj','[:no_count:] [name:Изумруды:name] [color:008844] [num:изумруд|изумруда|изумрудов:num] ','',$curloc,99
		gosub 'base.new.obj','[:?:] [name:<font color=#008888>Пустой предмет</font>:name] [number] [color:008844] [text:Описание пустого предмета:text]','',$curloc,1
		gosub 'base.new.obj','[:посох_файербол:]'
		gosub 'base.new.obj','[:посох_айсбол:]'
		gosub 'base.new.obj','[:посох_танцующие_молнии:]','','',1,30000
		! $args['f_b_id']=$func('base.new.obj','[:дублоны:]',"","SPACE",2)
		! gs 'add.obj.nocount',$args['f_b_id']
		$args['objs']=$func('add.new.obj','<obj>')
		args['moment1']=MSECSCOUNT
		:fore50
		if args['i']<50000:
			args['t']=rand(0,1000)
			if args['t']=535:
				if args['a']=0: gosub 'base.new.obj','[:ружьё_самопальное:]'
				if args['a']=1: gosub 'base.new.obj','[:ружьё_револьвер:]'
				if args['a']=2: gosub 'base.new.obj','[:патроны_револьверные:]'
				if args['a']=3: gosub 'base.new.obj','[:патроны_револьверные_патронтаж_2:]'
				if args['a']=4: gosub 'base.new.obj','[:патроны_револьверные_патронтаж_6:]'
				if args['a']=5: gosub 'base.new.obj','[:патроны_самопальные:]'
				if args['a']=6: gosub 'base.new.obj','[:радужный_меч:]'
			else
				if args['a']=0: gosub 'base.new.obj','[:ружьё_самопальное:]','',$args['objs']
				if args['a']=1: gosub 'base.new.obj','[:ружьё_револьвер:]','',$args['objs']
				if args['a']=2: gosub 'base.new.obj','[:патроны_револьверные:]','',$args['objs']
				if args['a']=3: gosub 'base.new.obj','[:патроны_револьверные_патронтаж_2:]','',$args['objs']
				if args['a']=4: gosub 'base.new.obj','[:патроны_револьверные_патронтаж_6:]','',$args['objs']
				if args['a']=5: gosub 'base.new.obj','[:патроны_самопальные:]','',$args['objs']
				if args['a']=6: gosub 'base.new.obj','[:радужный_меч:]','',$args['objs']
			end
			args['a']+=1
			if args['a']=7: args['a']=0
			args['i']+=1
			if args['i'] mod 1000 = 0:
				args['d']+=1
				if len(str(args['d']))<2:
					$args['strd']='00'+str(args['d'])
				elseif len(str(args['d']))<3:
					$args['strd']='0'+str(args['d'])
				else
					$args['strd']=str(args['d'])
				end
				*p $args['strd']+'|'
				if args['i'] mod 25000 = 0: *pl
			end
			jump 'fore50'
		end
		args['moment2']=MSECSCOUNT
		$lvar['локация.исходник']+='<br>Время затраченное на генерацию объектов: '+str(args['moment2']-args['moment1'])+'<br>'
		gs 'int.inventory'
		$lvar['локация.исходник']+='текст, который ты увидишь при первом посещении локации<br> Внимание! Этот текст будет виден лишь до тех пор, пока игрок не <<function+$func($args[0])>> выполняет никаких действий.<br><br>'
	else
		$lvar['локация.исходник']+='текст,
-
 который ты увидишь при поселдующих посещениях локации<br><br><br>'
	end
	! прочие скрипты
	$lvar['локация.исходник']+={[th]Стояло прекрасное [ty]летнее|осеннее|зимнее|весеннее[/ty] утро.|Стоял замечательный [ty]летний|осенний|зимний|весенний[/ty] день.|Стоял необычайно тихий [ty]летний|осенний|зимний|весенний[/ty] вечер.|Тиха [ty]летняя|осенняя|зимняя|весенняя[/ty] украинская ночь.[/th]
Внешней границы пустые обещания. (Дорогой//Дорогая), ты помнишь, о чём мы говорили? (Мальчик Мой//Девочка Моя), кто шёлковыми пальцами расчёсывает твои золотые кудри?
[goto]Вот гардероб в доме, который построил Джек.|[chest]|сундук;1_гардеробная||[м:1]_дом[/goto]
[lnk]кузница в доме|Кузница в доме, который построил Джек.[/lnk]<b>[дорогой//дорогая]</b>
[lnk]алтарь в доме|Жертвенный алтарь в доме, который построил Джек[/lnk]
<DIN5: if a=0: $result="<DIN1:$result="Проверка вложенности DIN удалась":1DIN>" :5DIN>
	[lnk]из дома на улицу|Выйти на улицу из дома, который построил Джек[/lnk]}
	$avar['действие']={!" <act:[name:<font color=#884488>Действие, которое будет воспроизводиться в любом случае</font>:name]:act>"
	goto '[м:0]_общий_вид_локации_места'
	}
	act '<font color=#884488>Действие, которое будет видно только при $GAME_INTERFACE["show.acts"]="show"</font>':
	goto '[м:0]_общий_вид_локации_места'
	end
end jfjfjjfjf даддадада 
--- [м:1]_дом ---------------------------------

# [м:2]_улица
! типичный вид локации места:
if здесь_был[$curloc]=0:
	! Заголовок здесь - является новым объектом игры! Добавляется объект с ай-ди-шником повторяющим название локации
	gosub 'add.new.obj','<заголовок> [name:Улица, где стоит дом, который построил Джек:name] [type:улица:type]','',$curloc
	! Переходы
	gosub 'add.new.obj','<link> [name:Войти в дом.:name] <goto:[loc:[м:1]_дом:loc] [time:[day:8] [minute:47]:time] [key:ключ_от_дома:key]:goto>','','с улицы в дом'
	! Яблоко
	gosub 'add.new.obj','<link> [name::name] [other:Посреди улицы стоит одинокая берёза.<br>:other] <obj:[io1:[:титановый_лук:] [kolvo:result=rand(2,5):kolvo]:io1]  [io2:[:лыковые_туфли:] [kolvo:result=1:kolvo]:io2]:obj> [respawn:[day:1]:respawn]','',"берёза"
end
$lvar['локация.исходник']={[lnk]с улицы в дом|Войти в дом, который построил Джек[/lnk]
[lnk]берёза|Посреди улицы стоит одинокая берёза.<br>|На берёзе созрело несколько титановых луков.<br>[/lnk]
[goto]Зайти в дом медленно (1 час 23 минуты)|[м:1]_дом| |[hour:1] [minute:23][/goto]}
--- [м:2]_улица ---------------------------------

# место;стандартная_кухня
! --------------------------------------- Обязательная конструкция -------------------------------------------

$args[0]=$args[0]	&	!	передаёт ай-ди локации
$args[1]=$args[1]	&	!	передаёт управляющую конструкцию
$args[2]=$args[2]	&	!	передаёт ай-ди исходной локации

$cvar['chest']=$args[0]
if $cvar[$cvar['chest']]='':
! $cvar удаляется только когда закрывается первый открытый сундук
	$cvar[$cvar['chest']]	=	$args[0]
	$cvar['back'+$cvar['chest']]	=	$args[2]
	$cvar['loc_id'+$cvar['chest']]	=	$args[0]
	$cvar['manage'+$cvar['chest']]	=	$args[1]
end
! ---------------------------------------- Обязательная конструкция -------------------------------------------
if ($args[1]='' or $strfind($args[1],'') ! '') or $strfind($args[1],'get.exposition')!'':
	$args['локация.исходник.описание']={}
end
--- место;стандартная_кухня ---------------------------------

# [chest]
! локация всех сундуков

! -----------------{------

-

--------------- Обязательная конструкция ---------------------}----------------------

$args[0]=$args[0]	&	!	передаёт ай-ди сундука
$args[1]=$args[1]	&	!	передаёт управляющее слово
$args[2]=$args[2]	&	!	передаёт ай-ди исходной локации

$cvar['chest']=$args[0]
if $cvar[$cvar['chest']]='':
! $cvar удаляется только когда закрывается первый открытый сундук
	$cvar[$cvar['chest']]	=	$args[0]
	$cvar['back'+$cvar['chest']]	=	$args[2]
	$cvar['loc_id'+$cvar['chest']]	=	$args[0]
	$cvar['manage'+$cvar['chest']]	=	$args[1]
end
! ---------------------------------------- Обязательная конструкция -------------------------------------------

! Необязательная, но относительно жёсткая конструкция по определению заголовков сундуков
if $cvar['manage'+$cvar['chest']]='':
! Если игрок "посещает" хранилище
	if здесь_смотрел[$cvar['loc_id'+$cvar['chest']]]=0:
	! если игрок посещает хранилище в первый раз
		! ------------------------------------------Стандартные заголовки для стандартных хранилищ--------------------------------------
			if $strfind($cvar['loc_id'+$cvar['chest']],'\сундук;[\d]+\_ларец')!"": gosub 'add.new.obj','<заголовок> [name:Шкатулка для драгоценностей:name]','',$cvar['loc_id'+$cvar['chest']]
			if $strfind($cvar['loc_id'+$cvar['chest']],'\сундук;[\d]+\_полка_для_шапок')!"": gosub 'add.new.obj','<заголовок> [name:Полка для шапок, перчаток, наплечней:name]','',$cvar['loc_id'+$cvar['chest']]
			if $strfind($cvar['loc_id'+$cvar['chest']],'\сундук;[\d]+\_вешалка_для_рубах')!"": gosub 'add.new.obj','<заголовок> [name:Вешалка для рубах:name]','',$cvar['loc_id'+$cvar['chest']]
			if $strfind($cvar['loc_id'+$cvar['chest']],'\сундук;[\d]+\_вешалка_для_штанов')!"": gosub 'add.new.obj','<заголовок> [name:Вешалка для штанов, брюк и юбок:name]','',$cvar['loc_id'+$cvar['chest']]
			if $strfind($cvar['loc_id'+$cvar['chest']],'\сундук;[\d]+\_полка_для_обуви')!"": gosub 'add.new.obj','<заголовок> [name:Полка для обуви:name]','',$cvar['loc_id'+$cvar['chest']]
			if $strfind($cvar['loc_id'+$cvar['chest']],'\сундук;[\d]+\_ящик_для_оружия')!"": gosub 'add.new.obj','<заголовок> [name:Ящик для оружия:name]','',$cvar['loc_id'+$cvar['chest']]
			if $strfind($cvar['loc_id'+$cvar['chest']],'\сундук;[\d]+\_ящик_для_стрел')!"": gosub 'add.new.obj','<заголовок> [name:Навесные ящички для стрел, болтов, магазинов и патронов:name]','',$cvar['loc_id'+$cvar['chest']]
			if $strfind($cvar['loc_id'+$cvar['chest']],'\сундук;[\d]+\_стандартный_шкаф_для_вещей')!"": gosub 'add.new.obj','<заголовок> [name:Шкаф для вещей со множеством секций:name] [put.stop]','',$cvar['loc_id'+$cvar['chest']]
			if $strfind($cvar['loc_id'+$cvar['chest']],'\сундук;[\d]+\_стойка_для_посохов')!"": gosub 'add.new.obj','<заголовок> [name:Очень длинная стойка для посохов:name] [target:[посох]:target]','',$cvar['loc_id'+$cvar['chest']]
		! ------------------------------------------Стандартные заголовки для стандартных хранилищ--------------------------------------
		if $cvar['loc_id'+$cvar['chest']]='сундук;1010_простая_кузница':
			gosub 'add.new.obj','<заголовок> [name:Кузница в доме, который построил Джек:name] [spec:[smithing]:spec] [respawn.stop] [target:[материал] [ингредиент]:target]','',$cvar['loc_id'+$cvar['chest']]
		end
		if $cvar['loc_id'+$cvar['chest']]='сундук;1_гардеробная':
			! обратите внимание на эту строку. У сундука, как и у локации места, или локации торговли не указывается место расположения. Все сунуки становятся дочерними объектами у объекта RESPAWNER
			gosub 'add.new.obj','<заголовок> [name:Гардеробная комната, которая находится в доме, который построил Джек:name]','',$cvar['loc_id'+$cvar['chest']]
			gosub 'base.new.obj','[:ружьё_самопальное:]','',$cvar['loc_id'+$cvar['chest']],6
			gosub 'base.new.obj','[:ружьё_револьвер:]','',$cvar['loc_id'+$cvar['chest']]
			gosub 'base.new.obj','[:патроны_револьверные:]','',$cvar['loc_id'+$cvar['chest']],34
			gosub 'base.new.obj','[:патроны_револьверные_патронтаж_2:]','',$cvar['loc_id'+$cvar['chest']],34
			gosub 'base.new.obj','[:патроны_револьверные_патронтаж_6:]','',$cvar['loc_id'+$cvar['chest']],34
			gosub 'base.new.obj','[:патроны_самопальные:]','',$cvar['loc_id'+$cvar['chest']],33
			gosub 'base.new.obj','[:радужный_меч:]','',$cvar['loc_id'+$cvar['chest']]
		end
		! -        -          - предметы -        -          -
		if $cvar['loc_id'+$cvar['chest']]='сундук;14002_полка_для_шапок':
			gosub 'base.new.obj','[:деревянный_шлем:]','',$cvar['loc_id'+$cvar['chest']]
			gosub 'base.new.obj','[:лыковые_наплечни:]','',$cvar['loc_id'+$cvar['chest']]
		end
		if $cvar['loc_id'+$cvar['chest']]='сундук;15002_вешалка_для_рубах':
			gosub 'base.new.obj','[:деревянная_кираса:]','',$cvar['loc_id'+$cvar['chest']],15
			gosub 'base.new.obj','[:лыковая_кираса:]','',$cvar['loc_id'+$cvar['chest']],4
		end
		if $cvar['loc_id'+$cvar['chest']]='сундук;16002_вешалка_для_штанов':
			gosub 'base.new.obj','[:лыковые_поножи:]','',$cvar['loc_id'+$cvar['chest']]
		end
		if $cvar['loc_id'+$cvar['chest']]='сундук;17002_полка_для_обуви':
			gosub 'base.new.obj','[:деревянные_башмаки:]','',$cvar['loc_id'+$cvar['chest']]
			gosub 'base.new.obj','[:лыковые_туфли:]','',$cvar['loc_id'+$cvar['chest']]
		end
		if $cvar['loc_id'+$cvar['chest']]='сундук;18002_ящик_для_оружия':
			gosub 'base.new.obj','[:деревянная_булава:]','','',5
			gosub 'base.new.obj','[:деревянный_меч:]','','',6
			gosub 'base.new.obj','[:деревянный_клеймор:]'
			gosub 'base.new.obj','[:деревянный_лук:]'
			gosub 'base.new.obj','[:клеёный_лук:]'
			gosub 'base.new.obj','[:деревянный_молот1:]'
			gosub 'base.new.obj','[:деревянный_щит:]'
		end
		if $cvar['loc_id'+$cvar['chest']]='сундук;19002_ящик_для_стрел':
			gosub 'base.new.obj','[:стрелы_деревянные:]'
		end
		if $cvar['loc_id'+$cvar['chest']]='сундук;14003_полка_для_шапок':
			gosub 'base.new.obj','[:тканевый_плащ:]'
		end
		if $cvar['loc_id'+$cvar['chest']]='сундук;18099_ящик_для_оружия':
			gosub 'base.new.obj','[:титановый_кинжал:]'
			gosub 'base.new.obj','[:титановый_меч:]'
			gosub 'base.new.obj','[:титановый_клеймор:]'
			gosub 'base.new.obj','[:титановый_лук:]'
			gosub 'base.new.obj','[:титановый_нож:]'
			gosub 'base.new.obj','[:титановый_молот1:]'
			gosub 'base.new.obj','[:титановый_молот2:]'
			gosub 'base.new.obj','[:титановый_топор1:]'
			gosub 'base.new.obj','[:титановый_топор2:]'
		end
		if $cvar['loc_id'+$cvar['chest']]='сундук;98_стойка_для_посохов':
			
		end
		if $cvar['loc_id'+$cvar['chest']]='сундук;14_ларец':
			gosub 'base.new.obj','[:жемчужина_голубая_большая:]'
		end
	end
	! если игрок посещает хранилище в любое время
	if $cvar['loc_id'+$cvar['chest']]='сундук;1_гардеробная':
		$lvar['локация.исходник']={
<a class="plain" href="exec:goto '[chest]','сундук;14_ларец','','сундук;1_гардеробная'">Шкатулка для драгоценностей</a>
<a class="plain" href="exec:goto '[chest]','сундук;2_стандартный_шкаф_для_вещей','','сундук;1_гардеробная'">Шкаф для деревянных вещей</a>
<a class="plain" href="exec:goto '[chest]','сундук;3_стандартный_шкаф_для_вещей','','сундук;1_гардеробная'">Шкаф для простой одежды</a>
<a class="plain" href="exec:goto '[chest]','сундук;4_стандартный_шкаф_для_вещей','','сундук;1_гардеробная'">Шкаф для костяных вещей</a>
<a class="plain" href="exec:goto '[chest]','сундук;5_стандартный_шкаф_для_вещей','','сундук;1_гардеробная'">Шкаф для каменных вещей</a>
<a class="plain" href="exec:goto '[chest]','сундук;6_стандартный_шкаф_для_вещей','','сундук;1_гардеробная'">Шкаф для ржавых вещей</a>
<a class="plain" href="exec:goto '[chest]','сундук;7_стандартный_шкаф_для_вещей','','сундук;1_гардеробная'">Шкаф для вещей из старой стали</a>
<a class="plain" href="exec:goto '[chest]','сундук;8_стандартный_шкаф_для_вещей','','сундук;1_гардеробная'">Шкаф для стальных вещей</a>
<a class="plain" href="exec:goto '[chest]','сундук;9_стандартный_шкаф_для_вещей','','сундук;1_гардеробная'">Шкаф для серебрянных вещей</a>
<a class="plain" href="exec:goto '[chest]','сундук;99_стандартный_шкаф_для_вещей','','сундук;1_гардеробная'">Шкаф для титановых вещей</a>
<a class="plain" href="exec:goto '[chest]','сундук;10_стандартный_шкаф_для_вещей','','сундук;1_гардеробная'">Шкаф для золотых вещей</a>
<a class="plain" href="exec:goto '[chest]','сундук;11_стандартный_шкаф_для_вещей','','сундук;1_гардеробная'">Шкаф для платиновых вещей</a>
<a class="plain" href="exec:goto '[chest]','сундук;12_стандартный_шкаф_для_вещей','','сундук;1_гардеробная'">Шкаф для дариевых вещей</a>
<a class="plain" href="exec:goto '[chest]','сундук;13_стандартный_шкаф_для_вещей','','сундук;1_гардеробная'">Шкаф для мирониевых вещей</a>
<a class="plain" href="exec:goto '[chest]','сундук;98_стойка_для_посохов','','сундук;1_гардеробная'">Стойка для посохов</a>}
	end
	! Стандартные шкафы для одежды
	if $strfind($cvar['loc_id'+$cvar['chest']],'\сундук;[\d]+\_стандартный_шкаф_для_вещей')!'':
		cvar['number']=val($strfind($cvar['loc_id'+$cvar['chest']],'\d+'))
		$lvar['локация.исходник']='<br><a class="plain" href='+'"exec:goto '+"'[chest]','сундук;"+str(14000+cvar['number'])+"_полка_для_шапок','','"+$cvar['chest']+"'"+'"'+'>[chestname]Полка для шапок<did:сундук;'+str(14000+cvar['number'])+'_полка_для_шапок:did>[/chestname]</a><br>'
		$lvar['локация.исходник']+='<a class="plain" href='+'"exec:goto '+"'[chest]','сундук;"+str(15000+cvar['number'])+"_вешалка_для_рубах','','"+$cvar['chest']+"'"+'"'+'>[chestname]Вешалка для рубах<did:сундук;'+str(15000+cvar['number'])+'_вешалка_для_рубах:did>[/chestname]</a><br>'
		$lvar['локация.исходник']+='<a class="plain" href='+'"exec:goto '+"'[chest]','сундук;"+str(16000+cvar['number'])+"_вешалка_для_штанов','','"+$cvar['chest']+"'"+'"'+'>[chestname]Вешалка для штанов<did:сундук;'+str(16000+cvar['number'])+'_вешалка_для_штанов:did>[/chestname]</a><br>'
		$lvar['локация.исходник']+='<a class="plain" href='+'"exec:goto '+"'[chest]','сундук;"+str(17000+cvar['number'])+"_полка_для_обуви','','"+$cvar['chest']+"'"+'"'+'>[chestname]Полка для обуви<did:сундук;'+str(17000+cvar['number'])+'_полка_для_обуви:did>[/chestname]</a><br>'
		$lvar['локация.исходник']+='<a class="plain" href='+'"exec:goto '+"'[chest]','сундук;"+str(18000+cvar['number'])+"_ящик_для_оружия','','"+$cvar['chest']+"'"+'"'+'>[chestname]Выдвижной ящик для оружия<did:сундук;'+str(18000+cvar['number'])+'_ящик_для_оружия:did>[/chestname]</a><br>'
		$lvar['локация.исходник']+='<a class="plain" href='+'"exec:goto '+"'[chest]','сундук;"+str(19000+cvar['number'])+"_ящик_для_стрел','','"+$cvar['chest']+"'"+'"'+'>[chestname]Навесные ящички для стрел и болтов<did:сундук;'+str(19000+cvar['number'])+'_ящик_для_стрел:did>[/chestname]</a><br>'
	end
	! Заметьте. Создав стандартные шкафы для одежды я зарезервировал все порядковые номера для хранилищ, начиная с 14000 и заканчивая 19999 включительно.
	
	! торговцы:
	if здесь_торговал[$cvar['loc_id'+$cvar['chest']]]=0:
		if $cvar['loc_id'+$cvar['chest']]='торговец;татиан':
			gosub 'add.new.obj','<заголовок> [name:Торговец Татиан в доме, который построил Джек:name] [tname:Татиан|Татиана|Татиану|Татиана|Татианом|Татиане:tname] [bank:1300] [respawn:[day:1]:respawn] [np:[чурка]:np]','','торговец;татиан'
			gosub 'base.new.obj','[:мирониевый_щит:]','','торговец;татиан'
			gosub 'base.new.obj','[:деревянный_клеймор:]','','',67
			$args['татиан.диалог']='
			npc="name:Татиан:name"
			hero="name:'+$property['hero.heroname']+':name"
			{:Поговорим!!!:}
			[:
				Привет, Татиан!
			:]
			[:
				закрыть диалог
				closeup
			:]
			'
			gosub 'add.new.obj','<act> [name:Поговорить:name]','торговец;татиан','ACTS',0,0,"gosub 'dialog.int','"+$args['татиан.диалог']+"'"
		end
	end
	if $cvar['loc_id'+$cvar['chest']]='торговец;татиан':
		if $tvar['приветствие.торговец;татиан']='': $tvar['приветствие.торговец;татиан']+=$func('b.d.s',"приветствие","торговец;татиан")+'<br>'
	end
end
--- [chest] ---------------------------------

# [death]
! локация смерти главного героя. Переменные не обнуляются, только выводится действие: начать игру заново. Уже это действие обнуляет все переменные.
! при попадании на эту локацию должно так же создаваться сохранение, чтобы в случае случайного выбора действия "начать игру заново", можно было
! загрузиться на локации и проверить, нет ли способа воскреснуть.
--- [death] ---------------------------------

# [help]

--- [help] ---------------------------------